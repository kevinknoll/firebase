<!DOCTYPE html>
<html ng-app="app">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title></title>
  <style>
    .cf:after {
      content: "";
      display: table;
      clear: both;
    }
    .pr { float: right; }

    .todos {
      border: 1px solid #ccc;
      padding-left: 0;
      width: 320px;
    }
    .todo {
      background: #f5f5f5;
      padding: 5px;
    }
    .todo:nth-child(even) {
      background: #ddd;
    }
  </style>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.7/angular.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/3.1.0/firebase.js"></script>
  <script src="https://cdn.firebase.com/libs/angularfire/2.0.1/angularfire.min.js"></script>
  <script>
    firebase.initializeApp({
      apiKey: "AIzaSyBKkYxHtbCIjX42hnkxg_SFB8MkSRiDf04",
      authDomain: "fir-4bba5.firebaseapp.com",
      databaseURL: "https://fir-4bba5.firebaseio.com",
      storageBucket: "",
    });

    angular.module('app', ['firebase'])

    .controller('UserController', [
      '$firebaseAuth',
      function ($firebaseAuth) {
        var t = this;
        var auth = $firebaseAuth();

        t.user = auth.$getAuth();

        t.login = function () {
          auth.$signInWithPopup('google').then(function (user) {
            t.user = user;
          }).catch(function (err) {
            // TODO: handle error
          });
        };

        t.logout = function () {
          auth.$deleteUser().then(function () {
            t.user = null;
          });
        };
      }
    ])

    .controller('ListController', [
      '$firebaseArray',
      function ($firebaseArray) {
        var t = this;
        var db = firebase.database().ref().child('items');

        t.items = $firebaseArray(db);
        t.newItem = {
          text: '',
          isComplete: false
        };

        t.addItem = function () {
          t.items.$add(angular.copy(t.newItem));
          t.newItem.text = '';
        };

        t.updateItem = function (item) {
          t.items.$save(item);
        };

        t.removeItem = function (item) {
          t.items.$remove(item);
        };
      }
    ]);
  </script>
</head>
<body>
  <div ng-controller="UserController as user">
    Logged in as: {{ user.user.user.email }}
    <button type="button" ng-click="user.login()" ng-hide="user.user">Login</button>
    <button type="button" ng-click="user.logout()" ng-show="user.user">Logout</button>
  </div>
  <div ng-controller="ListController as list">
    <h1>ToDos</h1>
    <ul class="todos">
      <li class="todo cf" ng-repeat="item in list.items">
        <label>
          <input type="checkbox" ng-model="item.isComplete" ng-click="list.updateItem(item);">
          {{ item.text }}
        </label>
        <button class="pr" ng-click="list.removeItem(item);">x</button>
      </li>
    </ul>
    <form ng-submit="list.addItem();">
      <label>
        New Item:
        <input type="text" ng-model="list.newItem.text">
      </label>
      <button type="submit">Add</button>
    </form>
  </div>
</body>
</html>